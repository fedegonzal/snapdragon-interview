<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interview Booking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body class="p-6 bg-gray-100" x-data="bookingApp">
    <h1 class="text-2xl font-bold mb-4">Book an Interview Slot</h1>
    <div id="schedule" class="overflow-x-auto">
        <template x-if="schedule.length">
            <table class="table-auto border-collapse w-full">
                <thead>
                    <tr>
                        <th>Time</th>
                        <template x-for="date in dates" :key="date">
                            <th x-text="date"></th>
                        </template>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="(row, rowIndex) in schedule" :key="rowIndex">
                        <tr>
                            <template x-for="cell in row" :key="cell.col">
                                <td class="border p-2 text-center" 
                                    :class="{
                                        'bg-green-200 cursor-pointer': cell.value === 1,
                                        'bg-gray-300': cell.value === 0,
                                        'bg-red-300': cell.value !== 1 && cell.value !== 0
                                    }"
                                    @click="bookSlot(cell)"
                                    x-text="cell.value === 1 ? '' : 'Booked'">
                                </td>
                            </template>
                        </tr>
                    </template>
                </tbody>
            </table>
        </template>
    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('bookingApp', () => ({
                scriptURL: 'https://script.google.com/macros/s/AKfycbyE3eeydyDzjCxnMrKgj2S0wn2Ez8CgwtdQqSP-Ep_fl7ruqYXMymnGxTNr2_6pkwUI/exec',
                dates: [],
                schedule: [],
                
                init() {
                    this.fetchSchedule();
                },
                
                fetchSchedule() {
                    fetch(`${this.scriptURL}?action=getSchedule`)
                        .then(response => response.json())
                        .then(data => {
                            this.dates = data.dates;
                            this.schedule = data.slots;
                        });
                },
                
                bookSlot(cell) {
                    if (cell.value !== 1) return;
                    let name = prompt('Enter your name:');
                    if (name) {
                        fetch(this.scriptURL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                            body: new URLSearchParams({
                                action: 'bookSlot', row: cell.row, col: cell.col, name: name
                            })
                        })
                        .then(response => response.json())
                        .then(data => {
                            alert(data.message);
                            this.fetchSchedule();
                        });
                    }
                }
            }));
        });
    </script>
</body>
</html>
